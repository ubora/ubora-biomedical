@using Ubora.Domain.Infrastructure.Specifications
@using Ubora.Domain.Resources
@using Ubora.Domain.Resources.Events
@using Ubora.Domain.Resources.Queries
@using Ubora.Web._Features.Projects.Workpackages.SideMenu
@inject Ubora.Domain.Infrastructure.Queries.IQueryProcessor QueryProcessor
@*<form style="visibility:hidden;">
        <div class="form-group">
            <input placeholder="Search..." class="form-control" type="text" />
        </div>
    </form>*@

@{
    var sideMenuFactory = new ResourcesHierarchySideMenuFactory(Url);
    var root = QueryProcessor.ExecuteQuery(new FindResourceMenuRootQuery());

    var model = new SideMenuViewModel
    {
        TopLevelMenuItems = sideMenuFactory.CreateSideMenuItems(root).ToList()
    };

    if (ViewContext.RouteData.Values["slugOrId"] != null)
    {
        ResourcesHierarchySideMenuFactory.MarkSelected(model.TopLevelMenuItems, (string)ViewContext.RouteData.Values["slugOrId"]);
    }
}

<nav class="nav flex-column">
    @Html.Partial("~/_Features/Projects/Workpackages/SideMenu/_WorkpackageSideMenuPartial.cshtml", model)
</nav>