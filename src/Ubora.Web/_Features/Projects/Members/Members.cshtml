@using Microsoft.AspNetCore.Html
@using Ubora.Web.Data
@using Ubora.Web._Features.Projects._Shared
@using Ubora.Web._Features.Users.UserList
@model Ubora.Web._Features.Projects.Members.ProjectMemberListViewModel

@{
    ViewData["Title"] = "Members";
    ViewData["MenuOption"] = ProjectMenuOption.Members;

    var isAdmin = User.IsInRole(ApplicationRole.Admin);
}

<div class="container my-4">
    <div class="row">
        <div class="col-lg-5">
            <h1 class="display-4">Project members</h1>
        </div>
        <div class="col-lg-7 d-flex justify-content-end">
            @if (Model.IsProjectMember)
            {
                <a class="btn btn-secondary-ghost align-self-start d-sm-block d-lg-inline-block" asp-controller="Members" asp-action="Invite">
                    <i class="material-icons">person_add</i>
                    <span>Invite member</span>
                </a>
            }

            @if (isAdmin)
            {
                <a class="btn btn-secondary-ghost align-self-start d-sm-block d-lg-inline-block ml-1" asp-controller="InviteMentors" asp-action="InviteMentors">
                    <i class="material-icons" id="MentorInviteButton">person_add</i>
                    <span>Add mentor</span>
                </a>
            }
        </div>
    </div>
    <div class="row">
        @{
            Func<Guid, IHtmlContent> createRemoveMemberFooter =
                @<a title="Remove member" asp-controller="Members" asp-action="RemoveMember" asp-route-memberId="@item">
                    <i class="material-icons">close</i>
                </a>;
        }
        @foreach (var member in Model.Members)
        {
            if (Model.CanRemoveProjectMembers && !member.IsCurrentUser)
            {
                Html.RenderPartial("~/_Components/UserCards/UserCard.cshtml", new UserCardViewModel(
                    userId: member.UserId,
                    name: member.FullName,
                    roles: member.Roles,
                    profilePictureUrl: member.ProfilePictureUrl,
                    footerHtml: createRemoveMemberFooter(member.UserId))
                );
            }
            else
            {
                Html.RenderPartial("~/_Components/UserCards/UserCard.cshtml", new UserCardViewModel(
                    userId: member.UserId,
                    name: member.FullName,
                    roles: member.Roles,
                    profilePictureUrl: member.ProfilePictureUrl)
                );
            }
        }
    </div>
</div>